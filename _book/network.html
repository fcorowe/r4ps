<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Population Science - 5&nbsp; Network Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sentiment-analysis.html" rel="next">
<link href="./sequence-analysis.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="Population Science - 5&nbsp; Network Analysis">
<meta name="twitter:description" content="In this session we need some basic R packages before importing the data.">
<meta name="twitter:creator" content="@fcorowe">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Network Analysis</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Population Science</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/fcorowe/r4ps" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Population-Science.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Population-Science.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
    <a href="" title="Share" id="sidebar-tool-dropdown-1" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-1">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./privacy.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Revolution</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./geodemographics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geodemographics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sequence-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sequence Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./network.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Network Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sentiment-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Sentiment Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./topic-modelling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Topic Modelling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal-1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modelling Time</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal-2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Assessing Interventions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machine-learning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Machine Learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-sec_dependencies" id="toc-sec-sec_dependencies" class="nav-link active" data-scroll-target="#sec-sec_dependencies"><span class="toc-section-number">5.1</span>  Dependencies</a></li>
  <li><a href="#sec-sec_data" id="toc-sec-sec_data" class="nav-link" data-scroll-target="#sec-sec_data"><span class="toc-section-number">5.2</span>  Data</a>
  <ul class="collapse">
  <li><a href="#the-us-census-dataset" id="toc-the-us-census-dataset" class="nav-link" data-scroll-target="#the-us-census-dataset"><span class="toc-section-number">5.2.1</span>  The US Census dataset</a></li>
  <li><a href="#import-the-data" id="toc-import-the-data" class="nav-link" data-scroll-target="#import-the-data"><span class="toc-section-number">5.2.2</span>  Import the data</a></li>
  </ul></li>
  <li><a href="#sec-sec_create" id="toc-sec-sec_create" class="nav-link" data-scroll-target="#sec-sec_create"><span class="toc-section-number">5.3</span>  Creating networks</a>
  <ul class="collapse">
  <li><a href="#starting-from-the-basics" id="toc-starting-from-the-basics" class="nav-link" data-scroll-target="#starting-from-the-basics"><span class="toc-section-number">5.3.1</span>  Starting from the basics</a></li>
  <li><a href="#adding-attributes" id="toc-adding-attributes" class="nav-link" data-scroll-target="#adding-attributes"><span class="toc-section-number">5.3.2</span>  Adding attributes</a></li>
  </ul></li>
  <li><a href="#sec-sec_reading" id="toc-sec-sec_reading" class="nav-link" data-scroll-target="#sec-sec_reading"><span class="toc-section-number">5.4</span>  Reading networks from data files</a>
  <ul class="collapse">
  <li><a href="#preparing-the-data-to-create-an-igraph-object" id="toc-preparing-the-data-to-create-an-igraph-object" class="nav-link" data-scroll-target="#preparing-the-data-to-create-an-igraph-object"><span class="toc-section-number">5.4.1</span>  Preparing the data to create an igraph object</a></li>
  <li><a href="#filtering-the-data-to-create-a-subgraph" id="toc-filtering-the-data-to-create-a-subgraph" class="nav-link" data-scroll-target="#filtering-the-data-to-create-a-subgraph"><span class="toc-section-number">5.4.2</span>  Filtering the data to create a subgraph</a></li>
  </ul></li>
  <li><a href="#sec-sec_visualise" id="toc-sec-sec_visualise" class="nav-link" data-scroll-target="#sec-sec_visualise"><span class="toc-section-number">5.5</span>  Network visualisation</a>
  <ul class="collapse">
  <li><a href="#visualisation-with-igraph" id="toc-visualisation-with-igraph" class="nav-link" data-scroll-target="#visualisation-with-igraph"><span class="toc-section-number">5.5.1</span>  Visualisation with igraph</a></li>
  <li><a href="#visualisation-of-spatial-networks" id="toc-visualisation-of-spatial-networks" class="nav-link" data-scroll-target="#visualisation-of-spatial-networks"><span class="toc-section-number">5.5.2</span>  Visualisation of spatial networks</a></li>
  <li><a href="#alternative-visualisations" id="toc-alternative-visualisations" class="nav-link" data-scroll-target="#alternative-visualisations"><span class="toc-section-number">5.5.3</span>  Alternative visualisations</a></li>
  </ul></li>
  <li><a href="#sec-sec_metrics" id="toc-sec-sec_metrics" class="nav-link" data-scroll-target="#sec-sec_metrics"><span class="toc-section-number">5.6</span>  Network metrics</a>
  <ul class="collapse">
  <li><a href="#density" id="toc-density" class="nav-link" data-scroll-target="#density"><span class="toc-section-number">5.6.1</span>  Density</a></li>
  <li><a href="#reciprocity" id="toc-reciprocity" class="nav-link" data-scroll-target="#reciprocity"><span class="toc-section-number">5.6.2</span>  Reciprocity</a></li>
  <li><a href="#degree" id="toc-degree" class="nav-link" data-scroll-target="#degree"><span class="toc-section-number">5.6.3</span>  Degree</a></li>
  <li><a href="#distances" id="toc-distances" class="nav-link" data-scroll-target="#distances"><span class="toc-section-number">5.6.4</span>  Distances</a></li>
  <li><a href="#centrality" id="toc-centrality" class="nav-link" data-scroll-target="#centrality"><span class="toc-section-number">5.6.5</span>  Centrality</a></li>
  </ul></li>
  <li><a href="#sec-sec_communities" id="toc-sec-sec_communities" class="nav-link" data-scroll-target="#sec-sec_communities"><span class="toc-section-number">5.7</span>  Communities</a></li>
  <li><a href="#final-visualisation" id="toc-final-visualisation" class="nav-link" data-scroll-target="#final-visualisation"><span class="toc-section-number">5.8</span>  Final visualisation</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/fcorowe/r4ps/edit/main/network.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-chp5" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Network Analysis</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="sec-sec_dependencies" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sec-sec_dependencies"><span class="header-section-number">5.1</span> Dependencies</h2>
<p>In this session we need some basic R packages before importing the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># An R package for network manipulation and analysis</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'igraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    as_data_frame, groups, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    decompose, spectrum</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:base':

    union</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>() <span class="co">#Obtain the working directory, where we will save the data folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/Users/franciscorowe/Dropbox/Francisco/uol/teaching/envs418/202223/r4ps"</code></pre>
</div>
</div>
</section>
<section id="sec-sec_data" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="sec-sec_data"><span class="header-section-number">5.2</span> Data</h2>
<section id="the-us-census-dataset" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="the-us-census-dataset"><span class="header-section-number">5.2.1</span> The US Census dataset</h3>
<p>Describe here the dataset used for this session. It has been cleaned beforehand by myself.</p>
<p>Each row corresponds to a origin-destination pair, the number or rows gives the total number of reported migratory movements.</p>
</section>
<section id="import-the-data" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="import-the-data"><span class="header-section-number">5.2.2</span> Import the data</h3>
<p>Before we start any analysis with the data, ensure to set the path to the directory where we are working. Please replace in the following line the path to the folder where you have placed the data file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/metro_to_metro_2015_2019_US_migration.csv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensure the MSA code is imported as a character and not as a number</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MSA_Current_Code <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>MSA_Current_Code) </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Include an additional column with the full name of the MSA in the format: Name, State</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MSA_Previous_Name_State <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>MSA_Previous_Name, <span class="st">', '</span>, df<span class="sc">$</span>MSA_Previous_State)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>MSA_Current_Name_State <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>MSA_Current_Name, <span class="st">', '</span>, df<span class="sc">$</span>MSA_Current_State)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Examine the first few rows of the dataset</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MSA_Current_Code MSA_Current_Name MSA_Current_State
1            10180          Abilene                TX
2            10180          Abilene                TX
3            10180          Abilene                TX
4            10180          Abilene                TX
5            10180          Abilene                TX
6            10180          Abilene                TX
  MSA_Current_Population_1_Year_and_Over_Estimate
1                                         168,306
2                                         168,306
3                                         168,306
4                                         168,306
5                                         168,306
6                                         168,306
  MSA_Current_Population_1_Year_and_Over_MOE MSA_Previous_Code
1                                        300             10740
2                                        300             11100
3                                        300             12060
4                                        300             12220
5                                        300             12420
6                                        300             12580
                 MSA_Previous_Name MSA_Previous_State
1                      Albuquerque                 NM
2                         Amarillo                 TX
3 Atlanta-Sandy Springs-Alpharetta                 GA
4                   Auburn-Opelika                 AL
5     Austin-Round Rock-Georgetown                 TX
6        Baltimore-Columbia-Towson                 MD
  MSA_Previous_Population_1_Year_and_Over_Estimate
1                                          902,213
2                                          262,574
3                                        5,753,503
4                                          153,728
5                                        2,045,336
6                                        2,766,530
  MSA_Previous_Population_1_Year_and_Over_MOE
1                                       2,916
2                                       1,866
3                                       9,607
4                                       1,654
5                                       5,648
6                                       6,154
  Movers_Metro_to_Metro_Flow_Estimate Movers_Metro_to_Metro_Flow_MOE
1                                  41                             47
2                                 244                             98
3                                 118                             95
4                                  30                             40
5                                 289                             85
6                                   8                             15
               MSA_Previous_Name_State MSA_Current_Name_State
1                      Albuquerque, NM            Abilene, TX
2                         Amarillo, TX            Abilene, TX
3 Atlanta-Sandy Springs-Alpharetta, GA            Abilene, TX
4                   Auburn-Opelika, AL            Abilene, TX
5     Austin-Round Rock-Georgetown, TX            Abilene, TX
6        Baltimore-Columbia-Towson, MD            Abilene, TX</code></pre>
</div>
</div>
<p>We can obtain the total number of reported migratory movements with the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52930</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-sec_create" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="sec-sec_create"><span class="header-section-number">5.3</span> Creating networks</h2>
<p>Before we start to analyse the data introduced in <a href="#sec-sec_data"><span>Section&nbsp;5.2</span></a>, let us first take a step back to consider the main object of study of this Chapter: the so-called networks. In the most general sense, a <strong>network</strong> (also known as a graph) is a structure formed by a set of objects which may have some connections between them. The objects are represented by <strong>nodes</strong> (a.k.a. vertices) and the connections between these objects are represented by <strong>edges</strong> (a.k.a. links). Networks are used as a tool to conceptualise many real-life contexts, such as the friendships between the members of a year group at school, the direct airline connections between cities in a continent or the presence of hyperlinks between a set of websites. In this session, we will use networks to model the migratory flows between US cities.</p>
<section id="starting-from-the-basics" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="starting-from-the-basics"><span class="header-section-number">5.3.1</span> Starting from the basics</h3>
<p>In order to create, manipulate and analyse networks in R, we will use the igraph package, which we imported in <a href="#sec-sec_data"><span>Section&nbsp;5.2</span></a>. We start by creating a very simple network with the code below. The network contains five nodes and five edges and it is undirected, so the edges do not have orientations. The nodes and edges could represent, respectively, a set of cities and the presence of migration flows between these cities in two consecutive years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">graph</span>( <span class="at">edges=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">4</span>, <span class="dv">2</span>,<span class="dv">3</span>, <span class="dv">2</span>,<span class="dv">4</span>, <span class="dv">4</span>,<span class="dv">5</span>), <span class="at">n=</span><span class="dv">5</span>, <span class="at">directed=</span>F ) <span class="co"># Creates an undirected network with 5 nodes and 5 edges</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of nodes is given by argument n</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, the node labels or IDs are represented by numbers 1 to 5</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The edges are specified as a list of pairs of nodes</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g1) <span class="co"># A simple plot of the network allows us to visualise it</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If the connections between the nodes of a network are non-reciprocal, the network is called directed. For example, this could correspond to a situation where there are people moving from city 1 to city 2, but nobody moving from city 2 to city 1. Note that in the code below we have not only added directions to the edges, but we have also added a few additional parameters to the plot function in order to customise the diagram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">graph</span>( <span class="at">edges=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">4</span>, <span class="dv">2</span>,<span class="dv">3</span>, <span class="dv">4</span>,<span class="dv">1</span>, <span class="dv">4</span>,<span class="dv">2</span>, <span class="dv">4</span>,<span class="dv">5</span>), <span class="at">n=</span><span class="dv">7</span>, <span class="at">directed=</span>T ) <span class="co"># Creates a directed network with 7 nodes and 6 edges </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#note that we now have edge 1,4 and edge 4,1 and that 2 of the nodes are isolated</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g2, <span class="at">vertex.frame.color=</span><span class="st">"red"</span>,  <span class="at">vertex.label.color=</span><span class="st">"black"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label.cex=</span><span class="fl">0.9</span>, <span class="at">vertex.label.dist=</span><span class="fl">2.3</span>, <span class="at">edge.curved=</span><span class="fl">0.3</span>, <span class="at">edge.arrow.size=</span>.<span class="dv">5</span>, <span class="at">edge.color =</span> <span class="st">"blue"</span>, <span class="at">vertex.color=</span><span class="st">"yellow"</span>, <span class="at">vertex.size=</span><span class="dv">15</span>) <span class="co"># A simple plot of the network with a few extra features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The network can also be defined as a list containing pairs of named nodes. Then, it is not necessary to specify the number of nodes but the isolated nodes have to be included. The following code generates a network which is equivalent to the one above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> <span class="fu">graph</span>( <span class="fu">c</span>(<span class="st">"City 1"</span>,<span class="st">"City 2"</span>, <span class="st">"City 2"</span>,<span class="st">"City 3"</span>, <span class="st">"City 1"</span>,<span class="st">"City 4"</span>,  <span class="st">"City 4"</span>,<span class="st">"City 1"</span>,  <span class="st">"City 4"</span>,<span class="st">"City 2"</span>, <span class="st">"City 4"</span>,<span class="st">"City 5"</span>), <span class="at">isolates=</span><span class="fu">c</span>(<span class="st">"City 6"</span>, <span class="st">"City 7"</span>) ) </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g3, <span class="at">vertex.frame.color=</span><span class="st">"red"</span>,  <span class="at">vertex.label.color=</span><span class="st">"black"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label.cex=</span><span class="fl">0.9</span>, <span class="at">vertex.label.dist=</span><span class="fl">2.3</span>, <span class="at">edge.curved=</span><span class="fl">0.3</span>, <span class="at">edge.arrow.size=</span>.<span class="dv">5</span>, <span class="at">edge.color =</span> <span class="st">"blue"</span>, <span class="at">vertex.color=</span><span class="st">"yellow"</span>, <span class="at">vertex.size=</span><span class="dv">15</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="adding-attributes" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="adding-attributes"><span class="header-section-number">5.3.2</span> Adding attributes</h3>
<p>In R, we can add attributes to the nodes, edges and the network. To add attributes to the nodes, we first need to access them via the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ 7/7 vertices, named, from 5f4aea5:
[1] City 1 City 2 City 3 City 4 City 5 City 6 City 7</code></pre>
</div>
</div>
<p>The node attribute <em>name</em> is automatically generated from the node labels that we manually assigned before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g3)<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "City 1" "City 2" "City 3" "City 4" "City 5" "City 6" "City 7"</code></pre>
</div>
</div>
<p>But other node attributes could be added. For example, the current population of the cities represented by the nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g3)<span class="sc">$</span>population <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">134000</span>, <span class="dv">92000</span>, <span class="dv">549000</span>, <span class="dv">1786000</span>, <span class="dv">74000</span>, <span class="dv">8000</span>, <span class="dv">21000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, we can access the edges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">E</span>(g3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ 6/6 edges from 5f4aea5 (vertex names):
[1] City 1-&gt;City 2 City 2-&gt;City 3 City 1-&gt;City 4 City 4-&gt;City 1 City 4-&gt;City 2
[6] City 4-&gt;City 5</code></pre>
</div>
</div>
<p>and add edge attributes, such as the number of people moving from an origin to a destination city in two consecutive years. We call this attribute the <em>weight</em> of the edge, since if there is a lot of people going from one city to another, the connection between these cities has more importance or “weight” in the network.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">E</span>(g3)<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">3000</span>, <span class="dv">5000</span>, <span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">4000</span>)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can examine the adjacency matrix of the network, which represents the presence of edges between different pairs of nodes. In this case, each row corresponds to an origin city and each column to a destination:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>g3[] <span class="co">#The adjacency matrix of network g3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7 x 7 sparse Matrix of class "dgCMatrix"
       City 1 City 2 City 3 City 4 City 5 City 6 City 7
City 1      .   2000      .   5000      .      .      .
City 2      .      .   3000      .      .      .      .
City 3      .      .      .      .      .      .      .
City 4   1000   1000      .      .   4000      .      .
City 5      .      .      .      .      .      .      .
City 6      .      .      .      .      .      .      .
City 7      .      .      .      .      .      .      .</code></pre>
</div>
</div>
<p>We can also look at the existing node and edge attributes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vertex_attr</span>(g3) <span class="co">#Node attributes of g3. Use edge_attr() to access the edge attributes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$name
[1] "City 1" "City 2" "City 3" "City 4" "City 5" "City 6" "City 7"

$population
[1]  134000   92000  549000 1786000   74000    8000   21000</code></pre>
</div>
</div>
<p>Finally, it is possible to add network attributes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>g3<span class="sc">$</span>title <span class="ot">&lt;-</span> <span class="st">"Network of migration between cities"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-sec_reading" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="sec-sec_reading"><span class="header-section-number">5.4</span> Reading networks from data files</h2>
<section id="preparing-the-data-to-create-an-igraph-object" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="preparing-the-data-to-create-an-igraph-object"><span class="header-section-number">5.4.1</span> Preparing the data to create an igraph object</h3>
<p>At the beginning of the chapter, we defined a data frame called <em>df</em> based on some imported data from the US Census about migratory movements between different US cities, or more precisely, between US Metropolitan Statistical Areas. This is a large data frame containing 52,930 rows, but how can we turn this data frame into a network similar to the ones that we generated in <a href="#sec-sec_create"><span>Section&nbsp;5.3</span></a>. The igraph function <strong>graph_from_data_frame()</strong> can do this for us. To find out more about this function, we can run the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="st">"graph_from_data_frame"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see, the input data for <strong>graph_from_data_frame()</strong> needs to be in a certain format which is different from our migration data frame. In particular, the function requires three arguments: 1) <em>d</em>, which is a data frame containing an edge list in the first two columns and any additional columns are considered as edge attributes; 2) <em>vertices</em>, which is either NULL or a data frame with vertex metadata (i.e.&nbsp;vertex attributes); and 3) <em>directed</em>, which is a boolean argument indicating whether the network is directed or not. Our next task is therefore to obtain 1) and 2) from the migration data frame called <em>df</em>.</p>
<p>Let us start with argument 1). Each row in <em>df</em> will correspond to an edge in the migration network since it contains information about a pair of origin and destination cities for two consecutive years. The names of the origin and destination cities are given by the columns in <em>df</em> called <em>MSA_Previous_Name</em> and <em>MSA_Current_Name</em>. In addition, the column called <em>Movers_Metro_to_Metro_Flow_Estimate</em> gives the number of people moving between the origin and the destination cities, so this will be the weight attribute of each edge in the migration network. Hence, we can define a data frame of edges which we will call <em>df_edges</em> that conforms with the format required by the argument 1) as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The pipe operator used below and denoted by %&gt;% is a feature of the magrittr package, it takes the output of one function and passes it into another function as an argument</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates the df_edges data frame with data from df and renames the columns as "origin", "destination" and "weight"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>df_edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df<span class="sc">$</span>MSA_Previous_Name_State, df<span class="sc">$</span>MSA_Current_Name_State, df<span class="sc">$</span>Movers_Metro_to_Metro_Flow_Estimate) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">origin =</span> df.MSA_Previous_Name_State, <span class="at">destination =</span> df.MSA_Current_Name_State, <span class="at">weight =</span> df.Movers_Metro_to_Metro_Flow_Estimate) </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensure that the weight attribute is stored as a number and not as character </span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>df_edges<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>,<span class="st">""</span>,df_edges<span class="sc">$</span>weight)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For argument 2) we can define a data frame of nodes which we will call <em>df_nodes</em>, where each row will correspond to a unique node or city. To obtain all the unique cities from <em>df</em>, we can firstly obtain a data frame of unique origin cities, then a data frame of unique destinations, and finally, apply the <strong>full_join()</strong> function to these two data frames to obtain their union, which will be <em>df_nodes</em>. The name of the unique cities in <em>df_nodes</em> is in the column called <em>label</em>, the other columns can be seen as the nodes metadata.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_unique_origins <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(MSA_Previous_Name_State) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name =</span> MSA_Previous_Name_State) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>df_unique_destinations <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(MSA_Current_Name_State) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name =</span> MSA_Current_Name_State)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>df_nodes <span class="ot">&lt;-</span> <span class="fu">full_join</span>(df_unique_origins, df_unique_destinations, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, a directed migration network can be obtained with the following line of code. It should contain 386 nodes and 52,930 edges. You can test this yourself with the functions that you learnt in <a href="#sec-sec_create"><span>Section&nbsp;5.3</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>g_US <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> df_edges,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">vertices =</span> df_nodes,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">directed =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we try to plot the network <em>g3</em> containing the migratory movements between all the US cities with the <strong>plot()</strong> function as we did before, we obtain a result which is rather undesirable…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g_US)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="filtering-the-data-to-create-a-subgraph" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="filtering-the-data-to-create-a-subgraph"><span class="header-section-number">5.4.2</span> Filtering the data to create a subgraph</h3>
<p>We will dedicate the entirety of next section to explore tools that can help us improve the visualisation of networks, since it is one of the most important aspects of network analysis. To facilitate the visualisation in the examples shown in <a href="#sec-sec_visualise"><span>Section&nbsp;5.5</span></a>, we will work with a subset of the full network called <em>g_US</em>. A way to create a subnetwork is to filter the original data frame. In particular, we will filter <em>df</em> to only include cities from a state, in this case, Minnesota. To filter, we use the <strong>grepl()</strong> function, which stands for grep logical. Both <strong>grep()</strong> and <strong>grepl()</strong> allow us to check whether a pattern is present in a character string or vector of a character string. While the <strong>grep()</strong> function returns a vector of indices of the element if a pattern exists in that vector, the <strong>grepl()</strong> function returns TRUE if the given pattern is present in the vector. Otherwise, it returns FALSE. In this case, we are filtering the dataset so that only the rows where the field MSA_Current_State is WA, which is the official abbreviation for Washington state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_sub <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">'WA'</span>, MSA_Current_State)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">'WA'</span>, MSA_Previous_State)) <span class="co">#Filter the original data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can prepare the data as we did before to create <em>gUS</em>. But, instead of basing the network on <em>df</em>, we will generate it from <em>df_sub</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_sub_edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df_sub<span class="sc">$</span>MSA_Previous_Name, df_sub<span class="sc">$</span>MSA_Current_Name, df_sub<span class="sc">$</span>Movers_Metro_to_Metro_Flow_Estimate) <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">origin =</span> df_sub.MSA_Previous_Name, <span class="at">destination =</span> df_sub.MSA_Current_Name, <span class="at">weight =</span> df_sub.Movers_Metro_to_Metro_Flow_Estimate)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Split long names into several lines for visualisation purposes</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>df_sub_edges<span class="sc">$</span>origin <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"-</span><span class="sc">\n</span><span class="st">"</span>, df_sub_edges<span class="sc">$</span>origin)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>df_sub_edges<span class="sc">$</span>destination <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"-</span><span class="sc">\n</span><span class="st">"</span>, df_sub_edges<span class="sc">$</span>destination)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>df_sub_edges<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>,<span class="st">""</span>,df_sub_edges<span class="sc">$</span>weight)) </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>df_sub_unique_origins <span class="ot">&lt;-</span> df_sub <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(MSA_Previous_Name) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name =</span> MSA_Previous_Name) </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>df_sub_unique_destinations <span class="ot">&lt;-</span> df_sub <span class="sc">%&gt;%</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(MSA_Current_Name) <span class="sc">%&gt;%</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name =</span> MSA_Current_Name)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>df_sub_nodes <span class="ot">&lt;-</span> <span class="fu">full_join</span>(df_sub_unique_origins, df_sub_unique_destinations, <span class="at">by =</span> <span class="st">"name"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>df_sub_nodes<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"-</span><span class="sc">\n</span><span class="st">"</span>, df_sub_nodes<span class="sc">$</span>name)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>g_sub <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> df_sub_edges,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">vertices =</span> df_sub_nodes,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">directed =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-sec_visualise" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="sec-sec_visualise"><span class="header-section-number">5.5</span> Network visualisation</h2>
<section id="visualisation-with-igraph" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="visualisation-with-igraph"><span class="header-section-number">5.5.1</span> Visualisation with igraph</h3>
<p>Let us start by generating the most basic visualisation of <em>g_sub</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot can be improved by changing adding a few additional arguments to the <strong>plot()</strong> function. For example, by just changing the color and size of the labels, the color and size of the nodes and the arrow size of the edges, we can already see some improvements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g_sub, <span class="at">vertex.size=</span><span class="dv">10</span>, <span class="at">edge.arrow.size=</span>.<span class="dv">2</span>, <span class="at">edge.curved=</span><span class="fl">0.1</span>,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.color=</span><span class="st">"gold"</span>, <span class="at">vertex.frame.color=</span><span class="st">"black"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label=</span><span class="fu">V</span>(g_sub)<span class="sc">$</span>name, <span class="at">vertex.label.color=</span><span class="st">"black"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label.cex=</span>.<span class="dv">65</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>But there are few more things we can do not only to improve the look of the diagram, but also to include more information about the network. For example, we can set the size of the nodes so that it reflects the total number of people that the corresponding cities receive. We can do this by adding a new node attribute, <em>inflow</em>, which is obtained as the sum of the rows of the adjacency matrix of <em>g_sub</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g_sub)<span class="sc">$</span>inflow <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(g_sub[]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below we set the node size based on the inflow attribute. Note the formula <em>0.4*(V(gsub)$inflow)^0.4</em>, where the power of 0.4 is chosen to scale the size of the nodes in such a way that the largest ones do not get excessively large and the smallest ones do not get excessively small. We also set the edge width based on its weight, which is the total number of people migrating from the origin and destination cities that it connects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set node size based on inflow of migrants:</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g_sub)<span class="sc">$</span>size <span class="ot">&lt;-</span> <span class="fl">0.4</span><span class="sc">*</span>(<span class="fu">V</span>(g_sub)<span class="sc">$</span>inflow)<span class="sc">^</span><span class="fl">0.4</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set edge width based on weight:</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">E</span>(g_sub)<span class="sc">$</span>width <span class="ot">&lt;-</span> <span class="fu">E</span>(g_sub)<span class="sc">$</span>weight<span class="sc">/</span><span class="dv">1200</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the code below to discover how the aspect of the network has significantly improved with the modifications that we have introduced above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g_sub, <span class="at">vertex.size=</span><span class="fu">V</span>(g_sub)<span class="sc">$</span>size, <span class="at">edge.arrow.size=</span>.<span class="dv">15</span>, <span class="at">edge.arrow.width=</span>.<span class="dv">2</span>, <span class="at">edge.curved=</span><span class="fl">0.1</span>, <span class="at">edge.width=</span><span class="fu">E</span>(g_sub)<span class="sc">$</span>width, <span class="at">edge.color =</span><span class="st">"gray80"</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.color=</span><span class="st">"gold"</span>, <span class="at">vertex.frame.color=</span><span class="st">"gray90"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label=</span><span class="fu">V</span>(g_sub)<span class="sc">$</span>name, <span class="at">vertex.label.color=</span><span class="st">"black"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label.cex=</span>.<span class="dv">65</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualisation-of-spatial-networks" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="visualisation-of-spatial-networks"><span class="header-section-number">5.5.2</span> Visualisation of spatial networks</h3>
<p>Firstly, we will import geographical data for the metropolitan and micropolitan statistical areas in the whole of the US, using the sf package. Here, we are only interested in the metropolitan areas so we will filter the data frame <em>cbsa_us</em> to keep only the metropolitan areas, i.e.&nbsp;those entries with value M1 for the column named <em>LSAD.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Import core-based statistical areas https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.2020.html#list-tab-YXS5CUH5MBYOZ7MJLN</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>cbsa_us <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"./data/cb_2020_us_cbsa_500k/cb_2020_us_cbsa_500k.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `cb_2020_us_cbsa_500k' from data source 
  `/Users/franciscorowe/Dropbox/Francisco/uol/teaching/envs418/202223/r4ps/data/cb_2020_us_cbsa_500k/cb_2020_us_cbsa_500k.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 939 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -178.3347 ymin: 17.88328 xmax: -65.56427 ymax: 65.45352
Geodetic CRS:  NAD83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>msa_us <span class="ot">&lt;-</span> cbsa_us <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">'M1'</span>, LSAD)) <span class="co">#Filter the original data frame to obtain only metro areas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now find the centroid of each MSA polygon and add columns to <em>msa_us</em> for the longitude and latitude of each centroid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add longitude and latitude corresponding to centroid of each MSA polygon</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>msa_us<span class="sc">$</span>lon_centroid <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(msa_us<span class="sc">$</span>geometry))[,<span class="st">"X"</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>msa_us<span class="sc">$</span>lat_centroid <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(msa_us<span class="sc">$</span>geometry))[,<span class="st">"Y"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we are focusing on Washington state, let us filter <em>msa_us</em> so that it only includes data from Washington. This requires some data manipulation via the library stringr:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>msa_us<span class="sc">$</span>NAME_ONLY <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">",.*$"</span>, <span class="st">""</span>, msa_us<span class="sc">$</span>NAME) <span class="co">#Create a new column with the name of the state taken from the last two characters of entries in column NAME</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Long names of MSAs are split into lines for visualisation purposes</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>msa_us<span class="sc">$</span>NAME_ONLY <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"-</span><span class="sc">\n</span><span class="st">"</span>, msa_us<span class="sc">$</span>NAME_ONLY) </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>msa_us<span class="sc">$</span>STATE <span class="ot">&lt;-</span> <span class="fu">substr</span>(msa_us<span class="sc">$</span>NAME, <span class="fu">nchar</span>(msa_us<span class="sc">$</span>NAME)<span class="sc">-</span><span class="dv">1</span>, <span class="fu">nchar</span>(msa_us<span class="sc">$</span>NAME)) <span class="co">#Create a new column with the name of the state taken from the last two characters of entries in column NAME</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>msa_sub <span class="ot">&lt;-</span> msa_us <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">'WA'</span>, STATE)) <span class="co">#Filter to keep the metro areas belonging to Washington state only</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now plot the polygons for the MSA belonging to Washington state as well as the centroids:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(msa_sub))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_centroid</span>(msa_sub<span class="sc">$</span>geometry), <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">pch=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, we still need to link this data to the network data that we obtained before. In order to incorporate the geographic information to the nodes of the migration subnetwork, we can join data from two data frames: <em>msa_sub</em>, which contains the geographic data, and <em>df_sub_nodes</em>, which contains the names of the nodes. To do this, we can use the function <strong>left_join()</strong> and then, select only the columns of interest. For more information on this magical function, check <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">this link</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Join the data frame of nodes df_sub_nodes with the geographic information of the centroid of each MSA</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df_sub_spatial_nodes <span class="ot">&lt;-</span> df_sub_nodes <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(msa_sub, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"name"</span> <span class="ot">=</span> <span class="st">"NAME_ONLY"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"lon_centroid"</span>, <span class="st">"lat_centroid"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df_sub_spatial_nodes[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(msa_sub), <span class="at">border=</span><span class="fu">adjustcolor</span>(<span class="st">"gray50"</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g_sub, <span class="at">layout=</span>lo, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">rescale =</span> <span class="cn">FALSE</span>, <span class="at">vertex.size=</span><span class="fu">V</span>(g_sub)<span class="sc">$</span>size, <span class="at">edge.arrow.size=</span>.<span class="dv">1</span>, <span class="at">edge.arrow.width=</span><span class="fl">1.</span>, <span class="at">edge.curved=</span><span class="fl">0.1</span>, <span class="at">edge.width=</span><span class="fu">E</span>(g_sub)<span class="sc">$</span>width, <span class="at">edge.color=</span><span class="fu">adjustcolor</span>(<span class="st">"gray80"</span>, <span class="at">alpha.f =</span> .<span class="dv">6</span>), <span class="at">vertex.color=</span><span class="st">"gold"</span>, <span class="at">vertex.frame.color=</span><span class="st">"gray90"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label=</span><span class="fu">V</span>(g_sub)<span class="sc">$</span>name, <span class="at">vertex.label.color=</span><span class="st">"black"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="at">vertex.label.cex=</span>.<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="alternative-visualisations" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="alternative-visualisations"><span class="header-section-number">5.5.3</span> Alternative visualisations</h3>
<p>In this session we have based our visualisations on igraph, however, there exist a variety of packages that would also allow us to generate nice plots of networks.</p>
<p>For example, COMPLETE</p>
<p>In addition, migration networks are particularly well-suited to be represented as a chord diagram. If you want to explore this type of visualisation, you can find further information on the <a href="https://www.rdocumentation.org/packages/circlize/versions/0.4.15/topics/chordDiagram">official R documentation</a> and also, for example, on this other link <a href="https://r-graph-gallery.com/122-a-circular-plot-with-the-circlize-package.html">link</a>.</p>
</section>
</section>
<section id="sec-sec_metrics" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="sec-sec_metrics"><span class="header-section-number">5.6</span> Network metrics</h2>
<p>Here we define some of the most important metrics that help us quantify different characteristics of a network. We will use the migration network for the whole of the US again, <em>g_US</em>. It has more nodes and edges than <em>g_sub</em> and consequently, its behaviour is richer and helps us illustrate better the concepts that we introduce in this section.</p>
<section id="density" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="density"><span class="header-section-number">5.6.1</span> Density</h3>
<p>The network <strong>density</strong> is defined as the proportion of existing edges out of all the possible edges. In a network with <span class="math inline">\(n\)</span> nodes, the total number of possible edges is $n\times(n-1)$, i.e.&nbsp;the number of edges if each node was connected to all the other nodes. A density equal to <span class="math inline">\(1\)</span> corresponds to a situation where <span class="math inline">\(n\times(n-1)\)</span> edges are present. A network with no edges at all would have density equal to <span class="math inline">\(0\)</span>. The line of code below tells us that the density of <em>g_sub</em> is approximately 0.33, meaning that about 33% of all the possible edges are present, or in other words, that there are migratory movements between almost a third of every pair of cities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">edge_density</span>(g_US, <span class="at">loops=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3283458</code></pre>
</div>
</div>
</section>
<section id="reciprocity" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="reciprocity"><span class="header-section-number">5.6.2</span> Reciprocity</h3>
<p>The <strong>reciprocity</strong> in a directed network is the proportion of reciprocated connections between nodes (i.e.&nbsp;number of pairs of nodes with edges in both directions) from all the existing edges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reciprocity</span>(g_US)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6067259</code></pre>
</div>
</div>
<p>From this result, we conclude that about 62% of the pairs of nodes that are connected have edges in both directions.</p>
</section>
<section id="degree" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="degree"><span class="header-section-number">5.6.3</span> Degree</h3>
<p>The <strong>total degree</strong> of a node refers to the number of edges that emerge from or point at that node. The <strong>in-degree</strong> of a node in a directed network is the number of edges that point at it whereas the <strong>out-degree</strong> is the number of edges that emerge from it. The <strong>degree()</strong> functions, allows us to compute the degree of one or more nodes and allows us to specify if we are interested in the total degree, the in-degree or the out-degree.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute degree of the nodes given by v belonging to graph g_US, in this case the in-degree</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>deg <span class="ot">&lt;-</span> <span class="fu">degree</span>(g_US, <span class="at">v=</span><span class="fu">V</span>(g_US), <span class="at">mode=</span><span class="st">"in"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Produces histogram of the frequency of nodes with a certain in-degree</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(deg, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main=</span><span class="st">"Histogram of node in-degree"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="network_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As we can see in the histogram, many cities receive immigrants from 60-70 different cities. Very few cities receive immigrants from 300 or above cities. We can check which is the city with the maximum in-degree.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g_US)<span class="sc">$</span>name[<span class="fu">degree</span>(g_US, <span class="at">mode=</span><span class="st">"in"</span>)<span class="sc">==</span><span class="fu">max</span>(<span class="fu">degree</span>(g_US, <span class="at">mode=</span><span class="st">"in"</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Phoenix-Mesa-Chandler, AZ"                   
[2] "Washington-Arlington-Alexandria, DC-VA-MD-WV"</code></pre>
</div>
</div>
<p>We actually obtain a tie between two: the MSA containing Phoenix in Arizona and the MSA containing Washington DC, which actually spans over four states. Their in-degree is 354 as we can see below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">degree</span>(g_US, <span class="at">v=</span><span class="fu">c</span>(<span class="st">"Phoenix-Mesa-Chandler, AZ"</span>), <span class="at">mode=</span><span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Phoenix-Mesa-Chandler, AZ 
                      354 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">degree</span>(g_US, <span class="at">v=</span><span class="fu">c</span>(<span class="st">"Washington-Arlington-Alexandria, DC-VA-MD-WV"</span>), <span class="at">mode=</span><span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Washington-Arlington-Alexandria, DC-VA-MD-WV 
                                         354 </code></pre>
</div>
</div>
<p>Note that the fact that these two cities have the largest in-degree does not necessarily mean that they are the ones receiving the largest number of migrants.</p>
</section>
<section id="distances" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4" class="anchored" data-anchor-id="distances"><span class="header-section-number">5.6.4</span> Distances</h3>
<p>Shortest path between nodes, mean distance, diameter ,etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diameter</span>(g_US)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 36</code></pre>
</div>
</div>
</section>
<section id="centrality" class="level3" data-number="5.6.5">
<h3 data-number="5.6.5" class="anchored" data-anchor-id="centrality"><span class="header-section-number">5.6.5</span> Centrality</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">centr_degree</span>(g_US, <span class="at">mode=</span><span class="st">"in"</span>, <span class="at">normalized=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$res
  [1] 198 108 330 108 283 275 127 182 116 175 104  66 251 285 187 104 344 198
 [19] 259 123 258 231 141 197 345 331 280 174  66 113 237 159 110  78 148  96
 [37] 230  63 304 261 220 132  44  73  55  76 300 169 166  95 115 333 115 121
 [55] 125 205 297  79 123  66 144  78 291 330 148  67 176 243 237 150 209 240
 [73] 311 354 105  96 282 230 277 134 228 101 279 304 276 222 110 204 316  73
 [91] 113 110 149 336  73 122 245  81 101 128  45 128 354  78 164 138 157   0
[109]   0   0   0   0   0   0 172  33 163 276 148 132 271 167 104 103 105  26
[127] 247 128  36 232 286  53 112 200 160  25 113 261  47  20   0  75  70 170
[145]  61 194 202  74  81 113 170 164  72 105 221  65  92 255  92 271 216 192
[163]  55 180 196 181  97 178 170 122 157 117  83 151 232 122 288 228 133 163
[181] 187  70 227 186  71  68 282  64 127 185 222 240 144  54 276 156 274 157
[199] 207 235 219 127  69  88 128 158 103 156  74 116 190 102 100 163  90 237
[217] 104 319  93  67  68  77 179 146   0   0  76 136  68  56 131 166 115  69
[235] 164  88 106  93 217  99  71 140 200  70  82  81 103  94 146 168 155 109
[253]  94  95  62 113  98 103 152 123  62  98  87 165 187  76  66 117  69  93
[271]  85 108  92  90 123 116  88 116 133 213  50  69 110 151  61  99 129  67
[289]  72  74  65 151 161  63  83 154  93 129 117 107 132 115 145 150 155 125
[307] 134 130 178  42  62 139 130 151 185 161  54  86  99 100  52  70  74 108
[325]  75 119 140 128 115 121 134 139  43  52  78  47  68  69  90  87 143  80
[343]  66  83  50 140 159  67  80 106 114  85 117 107  80 123  95  87  93  72
[361]  86  81  81  89  63  83  93  54  66 124  55 134  60 119  75  77  81 107
[379]  77  56  78 113  51  37  74 102  80 145 101  62  87  83 100  64  59  68
[397]  99  67  41  76  51  46

$centralization
[1] 0.5544472

$theoretical_max
[1] 161202</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-sec_communities" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="sec-sec_communities"><span class="header-section-number">5.7</span> Communities</h2>
</section>
<section id="final-visualisation" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="final-visualisation"><span class="header-section-number">5.8</span> Final visualisation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># V(g_US)$inflow &lt;- rowSums(as.matrix(g_US[]))</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set node size based on inflow of migrants:</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># V(g_US)$size &lt;- 0.03*(V(g_US)$inflow)^0.1</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Set edge width based on weight:</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># E(g_US)$width &lt;- E(g_US)$weight/1200</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># #Join the data frame of nodes df_sub_nodes with the geographic information of the centroid of each MSA</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df_spatial_nodes &lt;- df_nodes %&gt;% left_join(msa_us, by = c("name" = "NAME")) %&gt;% select(c("name", "lon_centroid", "lat_centroid"))</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># lo &lt;- as.matrix(df_spatial_nodes[,2:3])</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(msa_us), border=adjustcolor("gray50"))</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(g_US, layout=lo, add = TRUE, rescale = FALSE, vertex.size=V(g_US)$size, edge.arrow.size=.1, edge.arrow.width=1., edge.curved=0.1, edge.width=E(g_US)$width, edge.color=adjustcolor("gray80", alpha.f = .1), vertex.color="gold", vertex.frame.color=adjustcolor("gray100", alpha.f = .01),</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># vertex.label="", vertex.label.color="black",</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># vertex.label.cex=.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./sequence-analysis.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sequence Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sentiment-analysis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Sentiment Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Population Science was written by Francisco Rowe, Carmen Cabrera-Arnau, Elisabetta Pietrostefani.</div>   
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>